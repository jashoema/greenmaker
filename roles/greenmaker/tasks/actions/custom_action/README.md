# Action Name: custom_action

## Description
This remediation action allows for custom script logic external to Greenmaker to be executed.  Upon completion of script execution, it captures specified output from the custom script execution and assigns it to variables that can be used by Greenmaker for further processing.  custom_action is typically most helpful in situations where complex script logic is needed that would be non-trivial or impossible to implement with existing Greenmaker capabilities.

## Action Definition

### Action Type
Remediation Action

### Supported Input Arguments

| Name | Type | Description | Mandatory |
|------|------|-------------|-----------|
| type | String | Describes the type of external script to execute.  Currently, the only supported option is "ansible_role", which allows for the execution of an Ansible role with the name specified in the `name` argument | Yes |
| name | String | Name of external script to execute.  When `type` is set to "ansible_role", `name` is used to refer to the name of the Ansible role that we want to execute from the "roles" directory of the Ansible runtime environment.  | Yes |

### Supported Input Parameters

| Name | Type | Description | Mandatory |
|------|------|-------------|-----------|
| source | String | Name of fact / variable that we want to make available to the custom_action | No |
| target | String | The name by which the source variable will be accessed in the custom_action.  Contents of "source" variable are assigned to "target". | No |

### Supported Output Parameters

| Name | Type | Description | Mandatory |
|------|------|-------------|-----------|
| source | String | Name of fact / variable generated by external script that we want to ingest into Greenmaker for future use. | No |
| target | String | Name of the variable to which fact/variable content from source should be assigned. | No |

### Supported Test Input Parameters

| Name | Type | Description | Mandatory |
|------|------|-------------|-----------|
| N/A | | | |

### Return Criteria ###

N/A

### Supported ansible_network_os

- all

### Sample Usage

``` yaml

workflow:
  - step:
      metadata:
        name: "custom_action"
        description: |
          Execute custom_action
      on_true:
        - echo: 
            args:
              message: |
                eval_cli found the desired pattern. Failure code: {{ failure_code | default('') }}
        - custom_action:
            args:
              type: ansible_role
              name: custom_action_test
            input:
              - source: fact0
                target: var0
            output:
              - source: fact1
                target: var1
              - source: fact2
                target: var2
              - source: fact3
                target: var3
              - source: role_result
                target: custom_action_result
  - step: 
      metadata:
        name: "evaluate_custom_action_result"
        description: |
          Evaluate custom_action result
      validation:
        eval_var:
          args:
            var_name: role_result
            pattern: "success"
      on_true:
        - exit:
            args:
              reason: Success
      on_false:
        - exit:
            args:
              reason: Failure

```
